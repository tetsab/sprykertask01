"use strict";
(globalThis["webpackJsonp_yves_default"] = globalThis["webpackJsonp_yves_default"] || []).push([["quantity-counter"],{

/***/ "./src/Pyz/Yves/ShopUi/Theme/default/components/molecules/quantity-counter/quantity-counter.ts":
/*!*****************************************************************************************************!*\
  !*** ./src/Pyz/Yves/ShopUi/Theme/default/components/molecules/quantity-counter/quantity-counter.ts ***!
  \*****************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ QuantityCounter)
/* harmony export */ });
/* harmony import */ var ShopUi_models_component__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ShopUi/models/component */ "./vendor/spryker-shop/shop-ui/src/SprykerShop/Yves/ShopUi/Theme/default/models/component.ts");

class QuantityCounter extends ShopUi_models_component__WEBPACK_IMPORTED_MODULE_0__["default"] {
  constructor() {
    super(...arguments);
    this.quantityInput = void 0;
    this.decrButton = void 0;
    this.incrButton = void 0;
    this.value = void 0;
    this.duration = 1000;
    this.timeout = 0;
    this.formattedNumberInput = void 0;
  }
  readyCallback() {}
  init() {
    this.quantityInput = this.getElementsByClassName(this.jsName + "__input")[0];
    this.decrButton = this.getElementsByClassName(this.jsName + "__decr")[0];
    this.incrButton = this.getElementsByClassName(this.jsName + "__incr")[0];
    this.formattedNumberInput = this.getElementsByClassName(this.jsName + "__formatted-input")[0];
    this.value = this.getValue;
    this.mapEvents();
    this.setMaxQuantityToInfinity();
  }
  mapEvents() {
    var _this$quantityInput;
    this.decrButton.addEventListener('click', event => this.onChangeQuantity(event, 'decrease'));
    this.incrButton.addEventListener('click', event => this.onChangeQuantity(event, 'increase'));
    (_this$quantityInput = this.quantityInput) == null ? void 0 : _this$quantityInput.addEventListener('keydown', event => this.onKeyDown(event));
    if (this.autoUpdate) {
      this.quantityInput.addEventListener('change', () => this.delayToSubmit());
    }
  }
  onChangeQuantity(event, type) {
    event.preventDefault();
    if (this.isDisabled) {
      return;
    }
    var value = this.formattedNumberInput.unformattedValue;
    var isDecrease = value > this.minQuantity && type === 'decrease';
    var isIncrease = value < this.maxQuantity && type === 'increase';
    var shouldUpdate = isDecrease || isIncrease;
    if (!shouldUpdate) {
      return;
    }
    this.quantityInput.value = (isDecrease ? value - 1 : isIncrease ? value + 1 : value).toString();
    if (this.isAjaxMode) {
      this.delayToSubmit(true);
      return;
    }
    this.quantityInput.dispatchEvent(new Event('change'));
    this.quantityInput.dispatchEvent(new Event('input'));
  }
  delayToSubmit(triggerInput) {
    if (triggerInput === void 0) {
      triggerInput = false;
    }
    clearTimeout(this.timeout);
    this.timeout = window.setTimeout(() => {
      if (this.value === this.getValue) {
        return;
      }
      if (this.isAjaxMode && triggerInput) {
        this.quantityInput.dispatchEvent(new Event('input', {
          bubbles: true
        }));
        this.quantityInput.dispatchEvent(new Event('change', {
          bubbles: true
        }));
        return;
      }
      if (!this.isAjaxMode) {
        this.quantityInput.form.submit();
      }
    }, this.duration);
  }
  onKeyDown(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
    }
  }
  setMaxQuantityToInfinity() {
    if (!this.maxQuantity) {
      this.quantityInput.setAttribute('data-max-quantity', 'Infinity');
    }
  }
  get maxQuantity() {
    return +this.quantityInput.getAttribute('data-max-quantity');
  }
  get minQuantity() {
    return +this.quantityInput.getAttribute('data-min-quantity');
  }
  get autoUpdate() {
    return this.quantityInput.hasAttribute('data-auto-update');
  }
  get isDisabled() {
    return this.quantityInput.hasAttribute('disabled');
  }
  get getValue() {
    return this.formattedNumberInput.unformattedValue;
  }
  get isAjaxMode() {
    return !!this.quantityInput.getAttribute('data-ajax-mode');
  }
}

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aG9wVWkvVGhlbWUvZGVmYXVsdC9jb21wb25lbnRzL21vbGVjdWxlcy9xdWFudGl0eS1jb3VudGVyL3F1YW50aXR5LWNvdW50ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZvcm1hdHRlZE51bWJlcklucHV0IGZyb20gJ1Nob3BVaS9jb21wb25lbnRzL21vbGVjdWxlcy9mb3JtYXR0ZWQtbnVtYmVyLWlucHV0L2Zvcm1hdHRlZC1udW1iZXItaW5wdXQnO1xuaW1wb3J0IENvbXBvbmVudCBmcm9tICdTaG9wVWkvbW9kZWxzL2NvbXBvbmVudCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFF1YW50aXR5Q291bnRlciBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgcHJvdGVjdGVkIHF1YW50aXR5SW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgcHJvdGVjdGVkIGRlY3JCdXR0b246IEhUTUxCdXR0b25FbGVtZW50O1xuICAgIHByb3RlY3RlZCBpbmNyQnV0dG9uOiBIVE1MQnV0dG9uRWxlbWVudDtcbiAgICBwcm90ZWN0ZWQgdmFsdWU6IG51bWJlcjtcbiAgICBwcm90ZWN0ZWQgZHVyYXRpb24gPSAxMDAwO1xuICAgIHByb3RlY3RlZCB0aW1lb3V0ID0gMDtcbiAgICBwcm90ZWN0ZWQgZm9ybWF0dGVkTnVtYmVySW5wdXQ6IEZvcm1hdHRlZE51bWJlcklucHV0O1xuXG4gICAgcHJvdGVjdGVkIHJlYWR5Q2FsbGJhY2soKTogdm9pZCB7fVxuXG4gICAgcHJvdGVjdGVkIGluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMucXVhbnRpdHlJbnB1dCA9IDxIVE1MSW5wdXRFbGVtZW50PnRoaXMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShgJHt0aGlzLmpzTmFtZX1fX2lucHV0YClbMF07XG4gICAgICAgIHRoaXMuZGVjckJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD50aGlzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYCR7dGhpcy5qc05hbWV9X19kZWNyYClbMF07XG4gICAgICAgIHRoaXMuaW5jckJ1dHRvbiA9IDxIVE1MQnV0dG9uRWxlbWVudD50aGlzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYCR7dGhpcy5qc05hbWV9X19pbmNyYClbMF07XG4gICAgICAgIHRoaXMuZm9ybWF0dGVkTnVtYmVySW5wdXQgPSA8Rm9ybWF0dGVkTnVtYmVySW5wdXQ+KFxuICAgICAgICAgICAgdGhpcy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGAke3RoaXMuanNOYW1lfV9fZm9ybWF0dGVkLWlucHV0YClbMF1cbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuZ2V0VmFsdWU7XG5cbiAgICAgICAgdGhpcy5tYXBFdmVudHMoKTtcbiAgICAgICAgdGhpcy5zZXRNYXhRdWFudGl0eVRvSW5maW5pdHkoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgbWFwRXZlbnRzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmRlY3JCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHRoaXMub25DaGFuZ2VRdWFudGl0eShldmVudCwgJ2RlY3JlYXNlJykpO1xuICAgICAgICB0aGlzLmluY3JCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHRoaXMub25DaGFuZ2VRdWFudGl0eShldmVudCwgJ2luY3JlYXNlJykpO1xuICAgICAgICB0aGlzLnF1YW50aXR5SW5wdXQ/LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHRoaXMub25LZXlEb3duKGV2ZW50KSk7XG5cbiAgICAgICAgaWYgKHRoaXMuYXV0b1VwZGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5xdWFudGl0eUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHRoaXMuZGVsYXlUb1N1Ym1pdCgpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBvbkNoYW5nZVF1YW50aXR5KGV2ZW50OiBFdmVudCwgdHlwZTogJ2RlY3JlYXNlJyB8ICdpbmNyZWFzZScpOiB2b2lkIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBpZiAodGhpcy5pc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZm9ybWF0dGVkTnVtYmVySW5wdXQudW5mb3JtYXR0ZWRWYWx1ZTtcbiAgICAgICAgY29uc3QgaXNEZWNyZWFzZSA9IHZhbHVlID4gdGhpcy5taW5RdWFudGl0eSAmJiB0eXBlID09PSAnZGVjcmVhc2UnO1xuICAgICAgICBjb25zdCBpc0luY3JlYXNlID0gdmFsdWUgPCB0aGlzLm1heFF1YW50aXR5ICYmIHR5cGUgPT09ICdpbmNyZWFzZSc7XG4gICAgICAgIGNvbnN0IHNob3VsZFVwZGF0ZSA9IGlzRGVjcmVhc2UgfHwgaXNJbmNyZWFzZTtcblxuICAgICAgICBpZiAoIXNob3VsZFVwZGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5xdWFudGl0eUlucHV0LnZhbHVlID0gKGlzRGVjcmVhc2UgPyB2YWx1ZSAtIDEgOiBpc0luY3JlYXNlID8gdmFsdWUgKyAxIDogdmFsdWUpLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNBamF4TW9kZSkge1xuICAgICAgICAgICAgdGhpcy5kZWxheVRvU3VibWl0KHRydWUpO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnF1YW50aXR5SW5wdXQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScpKTtcbiAgICAgICAgdGhpcy5xdWFudGl0eUlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcpKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZGVsYXlUb1N1Ym1pdCh0cmlnZ2VySW5wdXQgPSBmYWxzZSk6IHZvaWQge1xuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgICAgICAgdGhpcy50aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUgPT09IHRoaXMuZ2V0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQWpheE1vZGUgJiYgdHJpZ2dlcklucHV0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5xdWFudGl0eUlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcsIHsgYnViYmxlczogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgdGhpcy5xdWFudGl0eUlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdjaGFuZ2UnLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQWpheE1vZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnF1YW50aXR5SW5wdXQuZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcy5kdXJhdGlvbik7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uS2V5RG93bihldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHNldE1heFF1YW50aXR5VG9JbmZpbml0eSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLm1heFF1YW50aXR5KSB7XG4gICAgICAgICAgICB0aGlzLnF1YW50aXR5SW5wdXQuc2V0QXR0cmlidXRlKCdkYXRhLW1heC1xdWFudGl0eScsICdJbmZpbml0eScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBtYXhRdWFudGl0eSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gK3RoaXMucXVhbnRpdHlJbnB1dC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWF4LXF1YW50aXR5Jyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBtaW5RdWFudGl0eSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gK3RoaXMucXVhbnRpdHlJbnB1dC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWluLXF1YW50aXR5Jyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBhdXRvVXBkYXRlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5xdWFudGl0eUlucHV0Lmhhc0F0dHJpYnV0ZSgnZGF0YS1hdXRvLXVwZGF0ZScpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgaXNEaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXVhbnRpdHlJbnB1dC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBnZXRWYWx1ZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXR0ZWROdW1iZXJJbnB1dC51bmZvcm1hdHRlZFZhbHVlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgaXNBamF4TW9kZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5xdWFudGl0eUlucHV0LmdldEF0dHJpYnV0ZSgnZGF0YS1hamF4LW1vZGUnKTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiQ29tcG9uZW50IiwiUXVhbnRpdHlDb3VudGVyIiwiY29uc3RydWN0b3IiLCJhcmd1bWVudHMiLCJxdWFudGl0eUlucHV0IiwiZGVjckJ1dHRvbiIsImluY3JCdXR0b24iLCJ2YWx1ZSIsImR1cmF0aW9uIiwidGltZW91dCIsImZvcm1hdHRlZE51bWJlcklucHV0IiwicmVhZHlDYWxsYmFjayIsImluaXQiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwianNOYW1lIiwiZ2V0VmFsdWUiLCJtYXBFdmVudHMiLCJzZXRNYXhRdWFudGl0eVRvSW5maW5pdHkiLCJfdGhpcyRxdWFudGl0eUlucHV0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwib25DaGFuZ2VRdWFudGl0eSIsIm9uS2V5RG93biIsImF1dG9VcGRhdGUiLCJkZWxheVRvU3VibWl0IiwidHlwZSIsInByZXZlbnREZWZhdWx0IiwiaXNEaXNhYmxlZCIsInVuZm9ybWF0dGVkVmFsdWUiLCJpc0RlY3JlYXNlIiwibWluUXVhbnRpdHkiLCJpc0luY3JlYXNlIiwibWF4UXVhbnRpdHkiLCJzaG91bGRVcGRhdGUiLCJ0b1N0cmluZyIsImlzQWpheE1vZGUiLCJkaXNwYXRjaEV2ZW50IiwiRXZlbnQiLCJ0cmlnZ2VySW5wdXQiLCJjbGVhclRpbWVvdXQiLCJ3aW5kb3ciLCJzZXRUaW1lb3V0IiwiYnViYmxlcyIsImZvcm0iLCJzdWJtaXQiLCJrZXkiLCJzZXRBdHRyaWJ1dGUiLCJnZXRBdHRyaWJ1dGUiLCJoYXNBdHRyaWJ1dGUiXSwic291cmNlUm9vdCI6IiJ9