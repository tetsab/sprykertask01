"use strict";
(globalThis["webpackJsonp_yves_default"] = globalThis["webpackJsonp_yves_default"] || []).push([["payone-klarna"],{

/***/ "./vendor/spryker-eco/payone/src/SprykerEco/Yves/Payone/Theme/default/components/molecules/payone-klarna/payone-klarna.ts":
/*!********************************************************************************************************************************!*\
  !*** ./vendor/spryker-eco/payone/src/SprykerEco/Yves/Payone/Theme/default/components/molecules/payone-klarna/payone-klarna.ts ***!
  \********************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PayoneKlarna)
/* harmony export */ });
/* harmony import */ var ShopUi_models_component__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ShopUi/models/component */ "./vendor/spryker-shop/shop-ui/src/SprykerShop/Yves/ShopUi/Theme/default/models/component.ts");
/* tslint:disable: max-file-line-count */


var TOKEN_CONTAINER_ID = 'paymentForm_payoneKlarna_payMethodToken';
var IS_VALID_PARAM = 'is_valid';
var GET_TOKEN_URL = '/payone/get-token';
var CONTAINER_ID = '#klarna_container';
class PayoneKlarna extends ShopUi_models_component__WEBPACK_IMPORTED_MODULE_0__["default"] {
  constructor() {
    super(...arguments);
    this.scriptLoader = void 0;
    this.selectField = void 0;
    this.availablePayment = void 0;
    this.availablePaymentArray = [];
    this.currentPaymentMethodCategory = void 0;
    this.currentPaymentCompanyToken = void 0;
    this.allKlarnaPayMethods = void 0;
    this.addressData = {
      'given_name': this.givenName,
      'family_name': this.familyName,
      'email': this.email,
      'street_address': this.streetAddress,
      'postal_code': this.postalCode,
      'city': this.city,
      'country': this.country,
      'phone': this.phone
    };
  }
  readyCallback() {}
  init() {
    this.scriptLoader = this.getElementsByClassName(this.jsName + "__script-loader")[0];
    this.selectField = this.getElementsByClassName(this.jsName + "__select-field")[0];
    this.allKlarnaPayMethods = JSON.parse(this.klarnaPayMethods());
    this.mapEvents();
  }
  mapEvents() {
    this.mapScriptLoadEvent();
    this.mapSelectChangeEvent();
  }
  mapScriptLoadEvent() {
    this.scriptLoader.addEventListener('scriptload', () => this.getAvailablePaymentMethods());
  }
  mapSelectChangeEvent() {
    this.selectField.addEventListener('change', () => this.selectPaymentMethod());
  }
  getAvailablePaymentMethods() {
    Array.from(this.selectField.options).forEach(option => {
      if (!option.value) {
        return;
      }
      var formData = new FormData();
      formData.append('pay_method', option.value);
      fetch(GET_TOKEN_URL, {
        method: 'POST',
        body: formData
      }).then(response => response.json()).then(parsedResponse => {
        if (!parsedResponse[IS_VALID_PARAM]) {
          return;
        }
        this.availablePayment = {
          'pay_method': option.value,
          'client_token': parsedResponse.client_token
        };
        this.availablePaymentArray.push(this.availablePayment);
        option.removeAttribute('disabled');
      }).catch(error => {
        console.error(error.message);
      });
    });
  }
  selectPaymentMethod() {
    var paymentMethod = this.availablePaymentArray.find(payment => payment.pay_method === this.selectField.value);
    this.loadKlarna(paymentMethod);
  }
  loadKlarna(paymentData) {
    this.toggleSelectFieldDisable(true);
    Klarna.Payments.init({
      client_token: paymentData.client_token
    });
    Klarna.Payments.load({
      container: CONTAINER_ID,
      payment_method_category: this.allKlarnaPayMethods[paymentData.pay_method]
    }, response => {
      this.toggleSelectFieldDisable(false);
      Klarna.Payments.authorize({
        payment_method_category: this.allKlarnaPayMethods[paymentData.pay_method]
      }, {
        billing_address: this.addressData,
        customer: {
          date_of_birth: this.dateOfBirth
        }
      }, response => {
        var tokenContainer = document.getElementById(TOKEN_CONTAINER_ID);
        tokenContainer.value = response.authorization_token;
      });
    });
  }
  toggleSelectFieldDisable(isSelectDisabled) {
    this.selectField.disabled = isSelectDisabled;
  }
  get givenName() {
    return this.getAttribute('given-name');
  }
  get familyName() {
    return this.getAttribute('family-name');
  }
  get email() {
    return this.getAttribute('email');
  }
  get streetAddress() {
    return this.getAttribute('street-address');
  }
  get postalCode() {
    return this.getAttribute('postal-code');
  }
  get city() {
    return this.getAttribute('city');
  }
  get country() {
    return this.getAttribute('country');
  }
  get phone() {
    return this.getAttribute('phone');
  }
  get dateOfBirth() {
    return this.getAttribute('date-of-birth');
  }
  klarnaPayMethods() {
    return this.getAttribute('klarna-pay-methods');
  }
}

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQztFQUMzQztFQUVBLElBQWM5RCxJQUFJQSxDQUFBLEVBQVc7SUFDekIsT0FBTyxJQUFJLENBQUM4RCxZQUFZLENBQUMsTUFBTSxDQUFDO0VBQ3BDO0VBRUEsSUFBYzdELE9BQU9BLENBQUEsRUFBVztJQUM1QixPQUFPLElBQUksQ0FBQzZELFlBQVksQ0FBQyxTQUFTLENBQUM7RUFDdkM7RUFFQSxJQUFjNUQsS0FBS0EsQ0FBQSxFQUFXO0lBQzFCLE9BQU8sSUFBSSxDQUFDNEQsWUFBWSxDQUFDLE9BQU8sQ0FBQztFQUNyQztFQUVBLElBQWNQLFdBQVdBLENBQUEsRUFBVztJQUNoQyxPQUFPLElBQUksQ0FBQ08sWUFBWSxDQUFDLGVBQWUsQ0FBQztFQUM3QztFQUVVckQsZ0JBQWdCQSxDQUFBLEVBQVc7SUFDakMsT0FBTyxJQUFJLENBQUNxRCxZQUFZLENBQUMsb0JBQW9CLENBQUM7RUFDbEQ7QUFDSiIsInNvdXJjZXMiOlsid2VicGFjazovL3NwcnlrZXItYjJjLWRlbW8tc2hvcC8uL3ZlbmRvci9zcHJ5a2VyLWVjby9wYXlvbmUvc3JjL1NwcnlrZXJFY28vWXZlcy9QYXlvbmUvVGhlbWUvZGVmYXVsdC9jb21wb25lbnRzL21vbGVjdWxlcy9wYXlvbmUta2xhcm5hL3BheW9uZS1rbGFybmEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogdHNsaW50OmRpc2FibGU6IG1heC1maWxlLWxpbmUtY291bnQgKi9cblxuaW1wb3J0IENvbXBvbmVudCBmcm9tICdTaG9wVWkvbW9kZWxzL2NvbXBvbmVudCc7XG5pbXBvcnQgU2NyaXB0TG9hZGVyIGZyb20gJ1Nob3BVaS9jb21wb25lbnRzL21vbGVjdWxlcy9zY3JpcHQtbG9hZGVyL3NjcmlwdC1sb2FkZXInO1xuXG5kZWNsYXJlIGNvbnN0IEtsYXJuYTtcbmNvbnN0IFRPS0VOX0NPTlRBSU5FUl9JRCA9ICdwYXltZW50Rm9ybV9wYXlvbmVLbGFybmFfcGF5TWV0aG9kVG9rZW4nO1xuY29uc3QgSVNfVkFMSURfUEFSQU0gPSAnaXNfdmFsaWQnO1xuY29uc3QgR0VUX1RPS0VOX1VSTCA9ICcvcGF5b25lL2dldC10b2tlbic7XG5jb25zdCBDT05UQUlORVJfSUQgPSAnI2tsYXJuYV9jb250YWluZXInO1xuXG5pbnRlcmZhY2UgUGF5bWVudERhdGEge1xuICAgICdjbGllbnRfdG9rZW4nOiBzdHJpbmc7XG4gICAgJ3BheV9tZXRob2QnOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBLbGFybmFQYXlNZXRob2RzIHtcbiAgICBLREQ6IHN0cmluZztcbiAgICBLSVM6IHN0cmluZztcbiAgICBLSVY6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEFkZHJlc3NEYXRhIHtcbiAgICAnZ2l2ZW5fbmFtZSc6IHN0cmluZztcbiAgICAnZmFtaWx5X25hbWUnOiBzdHJpbmc7XG4gICAgJ2VtYWlsJzogc3RyaW5nO1xuICAgICdzdHJlZXRfYWRkcmVzcyc6IHN0cmluZztcbiAgICAncG9zdGFsX2NvZGUnOiBzdHJpbmc7XG4gICAgJ2NpdHknOiBzdHJpbmc7XG4gICAgJ2NvdW50cnknOiBzdHJpbmc7XG4gICAgJ3Bob25lJzogc3RyaW5nO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYXlvbmVLbGFybmEgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIHByb3RlY3RlZCBzY3JpcHRMb2FkZXI6IFNjcmlwdExvYWRlcjtcbiAgICBwcm90ZWN0ZWQgc2VsZWN0RmllbGQ6IEhUTUxTZWxlY3RFbGVtZW50O1xuICAgIHByb3RlY3RlZCBhdmFpbGFibGVQYXltZW50OiBQYXltZW50RGF0YTtcbiAgICBwcm90ZWN0ZWQgYXZhaWxhYmxlUGF5bWVudEFycmF5OiBQYXltZW50RGF0YVtdID0gW107XG4gICAgcHJvdGVjdGVkIGN1cnJlbnRQYXltZW50TWV0aG9kQ2F0ZWdvcnk6IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgY3VycmVudFBheW1lbnRDb21wYW55VG9rZW46IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgYWxsS2xhcm5hUGF5TWV0aG9kczogS2xhcm5hUGF5TWV0aG9kcztcbiAgICBwcm90ZWN0ZWQgYWRkcmVzc0RhdGE6IEFkZHJlc3NEYXRhID0ge1xuICAgICAgICAnZ2l2ZW5fbmFtZSc6IHRoaXMuZ2l2ZW5OYW1lLFxuICAgICAgICAnZmFtaWx5X25hbWUnOiB0aGlzLmZhbWlseU5hbWUsXG4gICAgICAgICdlbWFpbCc6IHRoaXMuZW1haWwsXG4gICAgICAgICdzdHJlZXRfYWRkcmVzcyc6IHRoaXMuc3RyZWV0QWRkcmVzcyxcbiAgICAgICAgJ3Bvc3RhbF9jb2RlJzogdGhpcy5wb3N0YWxDb2RlLFxuICAgICAgICAnY2l0eSc6IHRoaXMuY2l0eSxcbiAgICAgICAgJ2NvdW50cnknOiB0aGlzLmNvdW50cnksXG4gICAgICAgICdwaG9uZSc6IHRoaXMucGhvbmUsXG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHJlYWR5Q2FsbGJhY2soKTogdm9pZCB7fVxuXG4gICAgcHJvdGVjdGVkIGluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2NyaXB0TG9hZGVyID0gPFNjcmlwdExvYWRlcj50aGlzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYCR7dGhpcy5qc05hbWV9X19zY3JpcHQtbG9hZGVyYClbMF07XG4gICAgICAgIHRoaXMuc2VsZWN0RmllbGQgPSA8SFRNTFNlbGVjdEVsZW1lbnQ+dGhpcy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGAke3RoaXMuanNOYW1lfV9fc2VsZWN0LWZpZWxkYClbMF07XG4gICAgICAgIHRoaXMuYWxsS2xhcm5hUGF5TWV0aG9kcyA9IDxLbGFybmFQYXlNZXRob2RzPkpTT04ucGFyc2UodGhpcy5rbGFybmFQYXlNZXRob2RzKCkpO1xuXG4gICAgICAgIHRoaXMubWFwRXZlbnRzKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG1hcEV2ZW50cygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5tYXBTY3JpcHRMb2FkRXZlbnQoKTtcbiAgICAgICAgdGhpcy5tYXBTZWxlY3RDaGFuZ2VFdmVudCgpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBtYXBTY3JpcHRMb2FkRXZlbnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2NyaXB0TG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3NjcmlwdGxvYWQnLCAoKSA9PiB0aGlzLmdldEF2YWlsYWJsZVBheW1lbnRNZXRob2RzKCkpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBtYXBTZWxlY3RDaGFuZ2VFdmVudCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZWxlY3RGaWVsZC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB0aGlzLnNlbGVjdFBheW1lbnRNZXRob2QoKSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldEF2YWlsYWJsZVBheW1lbnRNZXRob2RzKCk6IHZvaWQge1xuICAgICAgICBBcnJheS5mcm9tKHRoaXMuc2VsZWN0RmllbGQub3B0aW9ucykuZm9yRWFjaChvcHRpb24gPT4ge1xuICAgICAgICAgICAgaWYgKCFvcHRpb24udmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ3BheV9tZXRob2QnLCBvcHRpb24udmFsdWUpO1xuXG4gICAgICAgICAgICBmZXRjaChHRVRfVE9LRU5fVVJMLCB7bWV0aG9kOiAnUE9TVCcsIGJvZHk6IGZvcm1EYXRhfSlcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXG4gICAgICAgICAgICAgICAgLnRoZW4ocGFyc2VkUmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcnNlZFJlc3BvbnNlW0lTX1ZBTElEX1BBUkFNXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdmFpbGFibGVQYXltZW50ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3BheV9tZXRob2QnOiBvcHRpb24udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnY2xpZW50X3Rva2VuJzogcGFyc2VkUmVzcG9uc2UuY2xpZW50X3Rva2VuLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlUGF5bWVudEFycmF5LnB1c2godGhpcy5hdmFpbGFibGVQYXltZW50KTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3I6IEVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzZWxlY3RQYXltZW50TWV0aG9kKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBwYXltZW50TWV0aG9kID0gdGhpcy5hdmFpbGFibGVQYXltZW50QXJyYXkuZmluZChwYXltZW50ID0+IHBheW1lbnQucGF5X21ldGhvZCA9PT0gdGhpcy5zZWxlY3RGaWVsZC52YWx1ZSk7XG4gICAgICAgIHRoaXMubG9hZEtsYXJuYShwYXltZW50TWV0aG9kKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgbG9hZEtsYXJuYShwYXltZW50RGF0YTogUGF5bWVudERhdGEpOiB2b2lkIHtcbiAgICAgICAgdGhpcy50b2dnbGVTZWxlY3RGaWVsZERpc2FibGUodHJ1ZSk7XG5cbiAgICAgICAgS2xhcm5hLlBheW1lbnRzLmluaXQoeyBjbGllbnRfdG9rZW46IHBheW1lbnREYXRhLmNsaWVudF90b2tlbiB9KTtcbiAgICAgICAgS2xhcm5hLlBheW1lbnRzLmxvYWQoe1xuICAgICAgICAgICAgY29udGFpbmVyOiBDT05UQUlORVJfSUQsXG4gICAgICAgICAgICBwYXltZW50X21ldGhvZF9jYXRlZ29yeTogdGhpcy5hbGxLbGFybmFQYXlNZXRob2RzW3BheW1lbnREYXRhLnBheV9tZXRob2RdLFxuICAgICAgICB9LCAgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVTZWxlY3RGaWVsZERpc2FibGUoZmFsc2UpO1xuICAgICAgICAgICAgS2xhcm5hLlBheW1lbnRzLmF1dGhvcml6ZSh7XG4gICAgICAgICAgICAgICAgcGF5bWVudF9tZXRob2RfY2F0ZWdvcnk6IHRoaXMuYWxsS2xhcm5hUGF5TWV0aG9kc1twYXltZW50RGF0YS5wYXlfbWV0aG9kXSxcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBiaWxsaW5nX2FkZHJlc3M6IHRoaXMuYWRkcmVzc0RhdGEsXG4gICAgICAgICAgICAgICAgY3VzdG9tZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZV9vZl9iaXJ0aDogdGhpcy5kYXRlT2ZCaXJ0aCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSwgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuQ29udGFpbmVyID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoVE9LRU5fQ09OVEFJTkVSX0lEKTtcbiAgICAgICAgICAgICAgICB0b2tlbkNvbnRhaW5lci52YWx1ZSA9IHJlc3BvbnNlLmF1dGhvcml6YXRpb25fdG9rZW47XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIHByb3RlY3RlZCB0b2dnbGVTZWxlY3RGaWVsZERpc2FibGUoaXNTZWxlY3REaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICB0aGlzLnNlbGVjdEZpZWxkLmRpc2FibGVkID0gaXNTZWxlY3REaXNhYmxlZDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGdpdmVuTmFtZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGUoJ2dpdmVuLW5hbWUnKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGZhbWlseU5hbWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdmYW1pbHktbmFtZScpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgZW1haWwoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdlbWFpbCcpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgc3RyZWV0QWRkcmVzcygpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdHRyaWJ1dGUoJ3N0cmVldC1hZGRyZXNzJyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBwb3N0YWxDb2RlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZSgncG9zdGFsLWNvZGUnKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0IGNpdHkoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdjaXR5Jyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldCBjb3VudHJ5KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZSgnY291bnRyeScpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgcGhvbmUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdwaG9uZScpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgZGF0ZU9mQmlydGgoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRlLW9mLWJpcnRoJyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGtsYXJuYVBheU1ldGhvZHMoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKCdrbGFybmEtcGF5LW1ldGhvZHMnKTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiQ29tcG9uZW50IiwiVE9LRU5fQ09OVEFJTkVSX0lEIiwiSVNfVkFMSURfUEFSQU0iLCJHRVRfVE9LRU5fVVJMIiwiQ09OVEFJTkVSX0lEIiwiUGF5b25lS2xhcm5hIiwiY29uc3RydWN0b3IiLCJhcmd1bWVudHMiLCJzY3JpcHRMb2FkZXIiLCJzZWxlY3RGaWVsZCIsImF2YWlsYWJsZVBheW1lbnQiLCJhdmFpbGFibGVQYXltZW50QXJyYXkiLCJjdXJyZW50UGF5bWVudE1ldGhvZENhdGVnb3J5IiwiY3VycmVudFBheW1lbnRDb21wYW55VG9rZW4iLCJhbGxLbGFybmFQYXlNZXRob2RzIiwiYWRkcmVzc0RhdGEiLCJnaXZlbk5hbWUiLCJmYW1pbHlOYW1lIiwiZW1haWwiLCJzdHJlZXRBZGRyZXNzIiwicG9zdGFsQ29kZSIsImNpdHkiLCJjb3VudHJ5IiwicGhvbmUiLCJyZWFkeUNhbGxiYWNrIiwiaW5pdCIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiLCJqc05hbWUiLCJKU09OIiwicGFyc2UiLCJrbGFybmFQYXlNZXRob2RzIiwibWFwRXZlbnRzIiwibWFwU2NyaXB0TG9hZEV2ZW50IiwibWFwU2VsZWN0Q2hhbmdlRXZlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2V0QXZhaWxhYmxlUGF5bWVudE1ldGhvZHMiLCJzZWxlY3RQYXltZW50TWV0aG9kIiwiQXJyYXkiLCJmcm9tIiwib3B0aW9ucyIsImZvckVhY2giLCJvcHRpb24iLCJ2YWx1ZSIsImZvcm1EYXRhIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJmZXRjaCIsIm1ldGhvZCIsImJvZHkiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwicGFyc2VkUmVzcG9uc2UiLCJjbGllbnRfdG9rZW4iLCJwdXNoIiwicmVtb3ZlQXR0cmlidXRlIiwiY2F0Y2giLCJlcnJvciIsImNvbnNvbGUiLCJtZXNzYWdlIiwicGF5bWVudE1ldGhvZCIsImZpbmQiLCJwYXltZW50IiwicGF5X21ldGhvZCIsImxvYWRLbGFybmEiLCJwYXltZW50RGF0YSIsInRvZ2dsZVNlbGVjdEZpZWxkRGlzYWJsZSIsIktsYXJuYSIsIlBheW1lbnRzIiwibG9hZCIsImNvbnRhaW5lciIsInBheW1lbnRfbWV0aG9kX2NhdGVnb3J5IiwiYXV0aG9yaXplIiwiYmlsbGluZ19hZGRyZXNzIiwiY3VzdG9tZXIiLCJkYXRlX29mX2JpcnRoIiwiZGF0ZU9mQmlydGgiLCJ0b2tlbkNvbnRhaW5lciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJhdXRob3JpemF0aW9uX3Rva2VuIiwiaXNTZWxlY3REaXNhYmxlZCIsImRpc2FibGVkIiwiZ2V0QXR0cmlidXRlIl0sInNvdXJjZVJvb3QiOiIifQ==